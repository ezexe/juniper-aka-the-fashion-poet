<local:FilterablePageBase x:Class="Juniper.WinUI.App.Pages.InvoicesPage"
                          xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                          xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                          xmlns:local="using:Juniper.WinUI.App.Pages"
                          xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                          xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                          mc:Ignorable="d"
                          xmlns:interactionCore="using:Microsoft.Xaml.Interactions.Core"
                          xmlns:interaction="using:Microsoft.Xaml.Interactivity"
                          xmlns:dos="using:Juniper.WinUI.App.DependencyObjects"
                          xmlns:userControls="using:Juniper.WinUI.App.Controls"
                          xmlns:viewModels="using:Juniper.Core.ViewModels"
                          NavigationCacheMode="Enabled">
    <Page.Resources>
        <DataTemplate x:DataType="viewModels:InvoiceViewModel"
                      x:Name="vmTemplate">
            <Grid x:Name="controlMain"
                  Height="{StaticResource MultipleOf4RectHeightXXSmall}"
                  Width="{StaticResource MultipleOf4RectWidthXLarge}"
                  BorderThickness="{StaticResource ControlBorderThickness}"
                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  CornerRadius="{StaticResource ControlCornerRadius}">
                <Grid x:Name="controlRoot">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <interaction:Interaction.Behaviors>
                        <interactionCore:DataTriggerBehavior Binding="{x:Bind IsDupe,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                             Value="True">
                            <interactionCore:ChangePropertyAction TargetObject="{Binding ElementName=controlMain}"
                                                                  PropertyName="Background"
                                                                  Value="{StaticResource SystemFillColorCautionBackgroundBrush}" />
                        </interactionCore:DataTriggerBehavior>

                        <interactionCore:DataTriggerBehavior  Binding="{x:Bind IsDupe,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                              Value="False">
                            <interactionCore:ChangePropertyAction TargetObject="{Binding ElementName=controlMain}"
                                                                  PropertyName="Background"
                                                                  Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
                        </interactionCore:DataTriggerBehavior>

                        <interactionCore:DataTriggerBehavior  Binding="{x:Bind InternalINVSettings.IsPaid,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                              Value="True">
                            <interactionCore:ChangePropertyAction TargetObject="{Binding ElementName=controlMain}"
                                                                  PropertyName="Background"
                                                                  Value="{ThemeResource SystemFillColorSuccessBackgroundBrush}" />
                        </interactionCore:DataTriggerBehavior>
                        <interactionCore:DataTriggerBehavior  Binding="{x:Bind InternalINVSettings.IsPaid,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                              Value="False">
                            <interactionCore:ChangePropertyAction TargetObject="{Binding ElementName=controlMain}"
                                                                  PropertyName="Background"
                                                                  Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
                        </interactionCore:DataTriggerBehavior>
                    </interaction:Interaction.Behaviors>
                    
                    <StackPanel VerticalAlignment="Center"
                                HorizontalAlignment="Stretch">
                        <TextBlock HorizontalAlignment="Center"
                                   Style="{StaticResource BodyTextBlockStyle}">
                            <Run Text="{x:Bind InvoiceHeader.InvoiceDate, Converter={StaticResource StringFormatConverter},
                                ConverterParameter=' {0:ddd MM-dd-yyyy}'}" />
                        </TextBlock>

                        <TextBlock HorizontalAlignment="Center"
                                   Style="{StaticResource SubtitleTextBlockStyle}">
                                    <Run Text="{x:Bind PoId}" />
                        </TextBlock>

                        <TextBlock HorizontalAlignment="Center"
                                   Style="{StaticResource SubtitleTextBlockStyle}">
                                  <Run Text="{x:Bind ASNId}" />
                        </TextBlock>

                        <TextBlock HorizontalAlignment="Center"
                                   Style="{StaticResource SubtitleTextBlockStyle}">
                                    <Run Text="{x:Bind InvoiceHeader.InvoiceNumber}" />
                        </TextBlock>
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Text="{x:Bind FileCreationTime, Converter={StaticResource StringFormatConverter},   
                                                                   ConverterParameter=' {0:MM/dd/yyyy hh:mm:ss.fff}'}"
                                   Visibility="{x:Bind IsDupe,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,Converter={StaticResource boolToVisibilityConverter}}" />

                        <TextBlock Visibility="{x:Bind IsDupe,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,Converter={StaticResource boolToVisibilityConverter}}"
                                   TextWrapping="Wrap">
                            <Run Text="Dupe of" /> 
                            <Run Text="{x:Bind DuplicateOf}" />
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </Grid>
        </DataTemplate>
    </Page.Resources>
    <userControls:SemanticZoomBaseUserControl x:Name="sz"
                                              HeaderText="Invoices"
                                              ItemsSource="{x:Bind ViewModel.TradingPartners}"
                                              PropertyPath="InvoiceViewModels"
                                              ItemTemplate="{StaticResource vmTemplate}"
                                              ItemListViewItemClick="OnItemListViewItemClick">
        <userControls:SemanticZoomBaseUserControl.HeaderContent>
            <CommandBar>
                <AppBarButton x:Name="ABBMarkPaid" Icon="Accept"
                              Label="Mark Paid"
                              ToolTipService.ToolTip="Mark Selected Invoices As Paid"
                              AllowFocusOnInteraction="True"
                              IsEnabled="{x:Bind ViewModel.IsActionsEnabled,Mode=OneWay}">
                    <AppBarButton.Flyout>
                        <MenuFlyout Placement="Bottom">
                            <MenuFlyoutItem Text="Paid"
                                            x:Name="MFIPaid"
                                            Click="MFIPaid_Click" />
                            <MenuFlyoutItem Text="Not Paid"
                                            x:Name="NotPaid"
                                            Click="MFIPaid_Click" />
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarButton Icon="Redo"
                              Label="Send Selected"
                              ToolTipService.ToolTip="Resend Selected Invoices"
                              AllowFocusOnInteraction="True"
                              Click="AppBarButton_Click"
                              IsEnabled="{x:Bind ViewModel.IsActionsEnabled,Mode=OneWay}">
                </AppBarButton>

                <AppBarButton Icon="List"
                              Label="Send Listed"
                              ToolTipService.ToolTip="Resend Faild Invoices From List"
                              AllowFocusOnInteraction="True"
                              IsEnabled="{x:Bind ViewModel.OnCommand.IsRunning,Mode=OneWay,Converter={StaticResource inverseBoolConverter}}">
                    <Button.Flyout>
                        <Flyout Placement="Bottom">
                            <StackPanel HorizontalAlignment="Stretch">
                                <TextBox Header="Paste In Failed Invoice Numbers"
                                         Text="{x:Bind ViewModel.FailedInvoices,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource DefaultTextBoxStyle}"
                                         HorizontalAlignment="Stretch"
                                         Width="400"
                                         AcceptsReturn="True"
                                         InputScope="Text"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                         Margin="6" />
                                <Button Command="{x:Bind ViewModel.OnCommand}"
                                        CommandParameter="CommandReSendFailed"
                                        Content="Resend These"
                                        Margin="6"
                                        Style="{StaticResource AccentButtonStyle}"
                                        IsEnabled="{x:Bind ViewModel.OnCommand.IsRunning,Mode=OneWay,Converter={StaticResource inverseBoolConverter}}" />
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </AppBarButton>

                <AppBarButton Icon="Document"
                              Label="Export"
                              ToolTipService.ToolTip="Export Invoices To CSV format in Excel By Date"
                              AllowFocusOnInteraction="True">
                    <Button.Flyout>
                        <Flyout Placement="Bottom">
                            <StackPanel Orientation="Horizontal">
                                <userControls:DateFilterUserControl VerticalAlignment="Center">
                                    <userControls:DateFilterUserControl.DateFilterPropertys>
                                        <dos:DateFilterDependancyObject FilterBtnVisibility="Collapsed" />
                                    </userControls:DateFilterUserControl.DateFilterPropertys>
                                </userControls:DateFilterUserControl>

                                <Button Command="{x:Bind ViewModel.OnCommand}"
                                        CommandParameter="CommandExportCSVDataByDate"
                                        Content="Export Data"
                                        Margin="6"
                                        VerticalAlignment="Bottom"
                                        Style="{StaticResource AccentButtonStyle}" />
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </AppBarButton>
            </CommandBar>
        </userControls:SemanticZoomBaseUserControl.HeaderContent>
        <userControls:SemanticZoomBaseUserControl.HeaderOptionsContent>
            <userControls:CanFilterUserControl INVFilterVisibility="Visible"
                                               ASNFilterVisibility="Visible"
                                               OnBeforeFilterd="CanFilterUserControl_OnBeforeFilterd" />
        </userControls:SemanticZoomBaseUserControl.HeaderOptionsContent>
    </userControls:SemanticZoomBaseUserControl>
</local:FilterablePageBase>
